<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizator Kalorii</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçΩÔ∏è</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 8px 16px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .input-section {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e3e8ff;
        }

        .input-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .results-section {
            background: #fff8f0;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #ffe4cc;
        }

        .results-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .total-calories {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .total-calories h3 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .total-calories .number {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .products-list {
            background: white;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #eee;
        }

        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .product-item:last-child {
            border-bottom: none;
        }

        .product-name {
            font-weight: 600;
            color: #333;
        }

        .product-calories {
            color: #ff6b6b;
            font-weight: bold;
        }

        .history-section {
            grid-column: 1 / -1;
            background: #f0f8ff;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #d0e7ff;
            margin-top: 20px;
        }

        .history-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .history-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .history-date {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
        }

        .history-text {
            margin-bottom: 8px;
            color: #333;
        }

        .history-calories {
            font-weight: bold;
            color: #ff6b6b;
        }

        .clear-history {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .example {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #28a745;
        }

        .example-title {
            font-weight: bold;
            color: #155724;
            margin-bottom: 8px;
        }

        .example-text {
            color: #155724;
            font-style: italic;
        }

        /* Tryb ciemny */
        .dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .dark-mode .container {
            background: #2d3748;
            color: #e2e8f0;
        }

        .dark-mode .input-section {
            background: #4a5568;
            border-color: #718096;
        }

        .dark-mode .input-section h2 {
            color: #e2e8f0;
        }

        .dark-mode label {
            color: #cbd5e0;
        }

        .dark-mode textarea {
            background: #2d3748;
            border-color: #4a5568;
            color: #e2e8f0;
        }

        .dark-mode textarea:focus {
            border-color: #667eea;
        }

        .dark-mode .results-section {
            background: #4a5568;
            border-color: #718096;
        }

        .dark-mode .results-section h2 {
            color: #e2e8f0;
        }

        .dark-mode .products-list {
            background: #2d3748;
            border-color: #4a5568;
        }

        .dark-mode .product-item {
            border-bottom-color: #4a5568;
        }

        .dark-mode .product-name {
            color: #e2e8f0;
        }

        .dark-mode .history-section {
            background: #4a5568;
            border-color: #718096;
        }

        .dark-mode .history-section h2 {
            color: #e2e8f0;
        }

        .dark-mode .history-item {
            background: #2d3748;
            border-left-color: #667eea;
        }

        .dark-mode .history-text {
            color: #cbd5e0;
        }

        .dark-mode .example {
            background: #2d5016;
            border-left-color: #38a169;
        }

        .dark-mode .example-title {
            color: #68d391;
        }

        .dark-mode .example-text {
            color: #9ae6b4;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }

            .theme-toggle {
                top: 15px;
                right: 15px;
                padding: 6px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="theme-toggle" onclick="toggleTheme()">
                <span id="theme-icon">üåô</span>
                <span id="theme-text">Tryb ciemny</span>
            </button>
            <h1>üçΩÔ∏è Analizator Kalorii</h1>
            <p>Opisz co jad≈Çe≈õ w naturalnym jƒôzyku, a ja policzƒô kalorie!</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2>üìù Opisz swoje posi≈Çki</h2>
                <div class="input-group">
                    <label for="foodInput">Co jad≈Çe≈õ dzisiaj?</label>
                    <textarea 
                        id="foodInput" 
                        placeholder="Np. dzi≈õ jad≈Çem bu≈Çkƒô kajzerkƒô, dwa plasterki szynki, a na obiad talerz pomidorowej i saszetkƒô ry≈ºu..."
                    ></textarea>
                </div>
                <button class="analyze-btn" onclick="analyzeFood()">
                    üîç Analizuj kalorie
                </button>

                <div class="example">
                    <div class="example-title">Przyk≈Çad:</div>
                    <div class="example-text">
                        "Na ≈õniadanie zjad≈Çem dwa jajka sadzone z bu≈ÇkƒÖ, na lunch kanapkƒô z szynkƒÖ i serem, a na obiad kotlet schabowy z ziemniakami i sur√≥wkƒÖ"
                    </div>
                </div>
            </div>

            <div class="results-section">
                <h2>üìä Wyniki analizy</h2>
                <div id="results">
                    <div style="text-align: center; color: #666; padding: 40px;">
                        Wprowad≈∫ opis posi≈Çk√≥w i kliknij "Analizuj kalorie"
                    </div>
                </div>
            </div>
        </div>

        <div class="history-section">
            <h2>üìö Historia wpis√≥w</h2>
            <div id="history">
                <div style="text-align: center; color: #666; padding: 20px;">
                    Brak historii wpis√≥w
                </div>
            </div>
            <button class="clear-history" onclick="clearHistory()">üóëÔ∏è Wyczy≈õƒá historiƒô</button>
        </div>
    </div>

    <script>
        // Baza danych produkt√≥w z kaloriami (na 100g)
        const foodDatabase = {
            // Pieczywo
            'bu≈Çka kajzerka': 250,
            'bu≈Çka': 250,
            'kajzerka': 250,
            'chleb': 265,
            'bagietka': 272,
            'tost': 265,
            'bu≈Çka grahamka': 230,
            
            // Miƒôso i wƒôdliny
            'szynka': 145,
            'plasterk szynki': 30,
            'plasterek szynki': 30,
            'kie≈Çbasa': 280,
            'kotlet schabowy': 250,
            'kotlet': 250,
            'schabowy': 250,
            'kurczak': 165,
            'pier≈õ kurczaka': 165,
            'wo≈Çowina': 250,
            'wieprzowina': 242,
            'boczek': 541,
            'salami': 336,
            'mortadela': 311,
            
            // Dodatki do kanapek
            'kanapka z szynkƒÖ i serem': 400, // specjalna pozycja dla ca≈Çej kanapki
            
            // Nabia≈Ç
            'ser': 350,
            'ser ≈º√≥≈Çty': 350,
            'ser bia≈Çy': 98,
            'twar√≥g': 98,
            'mleko': 42,
            'jogurt': 61,
            'mas≈Ço': 717,
            '≈õmietana': 193,
            'kefir': 41,
            
            // Jajka
            'jajko': 155,
            'jajka': 155,
            'jajko sadzone': 196,
            'jajecznica': 196,
            
            // Zupy
            'zupa pomidorowa': 45,
            'pomidorowa': 45,
            'talerz pomidorowej': 135, // ~300ml
            '≈ºurek': 65,
            'ros√≥≈Ç': 25,
            'barszcz': 12,
            'krupnik': 89,
            'flaki': 87,
            
            // Ry≈º i makarony
            'ry≈º': 130,
            'saszetka ry≈ºu': 130,
            'makaron': 131,
            'spaghetti': 131,
            'kasza': 343,
            
            // Warzywa
            'ziemniaki': 77,
            'ziemniak': 77,
            'marchewka': 41,
            'kapusta': 25,
            'sur√≥wka': 45,
            'sur√≥wka z kapusty': 45,
            'sa≈Çata': 15,
            'pomidor': 18,
            'og√≥rek': 10,
            'cebula': 40,
            'papryka': 20,
            
            // Owoce
            'jab≈Çko': 52,
            'banan': 89,
            'pomara≈Ñcza': 43,
            'gruszka': 57,
            'truskawki': 32,
            
            // PrzekƒÖski
            'chipsy': 536,
            'czekolada': 534,
            'ciastko': 400,
            'lody': 207,
            'orzeszki': 567,
            'batonik': 450,
            
            // Napoje
            'coca cola': 42,
            'cola': 42,
            'piwo': 43,
            'wino': 83,
            'sok': 45,
            'herbata': 1,
            'kawa': 2
        };

        // Funkcja do rozpoznawania produkt√≥w i ilo≈õci
        function extractFoodItems(text) {
            const items = [];
            let lowerText = text.toLowerCase(); // Zmieni≈Çem const na let
            const foundProducts = new Set(); // ≈öledzenie ju≈º znalezionych produkt√≥w
            
            // Najpierw szukaj specjalnych kombinacji
            const specialCombinations = [
                { pattern: /kanapk[ƒÖƒô]\s+z\s+szynk[ƒÖƒô]\s+i\s+serem/gi, food: 'kanapka z szynkƒÖ i serem', calories: 400 },
                { pattern: /(dwa|dwie|2)\s+jajka\s+sadzone/gi, food: 'jajka sadzone', calories: 186, unit: '2 jajka sadzone' },
                { pattern: /(trzy|3)\s+jajka\s+sadzone/gi, food: 'jajka sadzone', calories: 279, unit: '3 jajka sadzone' },
                { pattern: /(jeden|jedno|1)\s+jajko\s+sadzone/gi, food: 'jajko sadzone', calories: 93, unit: '1 jajko sadzone' }
            ];
            
            for (const combo of specialCombinations) {
                if (lowerText.match(combo.pattern)) {
                    items.push({ name: `${combo.food} (${combo.unit || 'porcja'})`, calories: combo.calories });
                    foundProducts.add(combo.food);
                    // Usu≈Ñ znaleziony tekst, ≈ºeby nie by≈Ço duplikat√≥w
                    lowerText = lowerText.replace(combo.pattern, '');
                }
            }
            
            // Sortuj produkty od najd≈Çu≈ºszych do najkr√≥tszych
            const sortedFoods = Object.keys(foodDatabase).sort((a, b) => b.length - a.length);
            
            for (const food of sortedFoods) {
                // Pomi≈Ñ je≈õli ju≈º znaleziono w kombinacjach specjalnych
                if (foundProducts.has(food)) continue;
                
                // Sprawd≈∫ czy produkt ju≈º zosta≈Ç znaleziony jako czƒô≈õƒá d≈Çu≈ºszej nazwy
                const isSubstring = Array.from(foundProducts).some(found => 
                    found.includes(food) && found !== food
                );
                if (isSubstring) continue;
                
                // Utw√≥rz regex z granicami s≈Ç√≥w
                const foodWords = food.split(/\s+/);
                let pattern;
                
                if (foodWords.length === 1) {
                    // Pojedyncze s≈Çowo - z odmianami
                    const baseWord = foodWords[0];
                    if (baseWord === 'bu≈Çka') {
                        pattern = /bu≈Çk[ƒÖƒôi]/gi;
                    } else if (baseWord === 'szynka') {
                        pattern = /szynk[ƒÖƒôi]/gi;
                    } else if (baseWord === 'ser') {
                        pattern = /ser(em|u|ze)?/gi;
                    } else if (baseWord === 'ziemniak') {
                        pattern = /ziemniak(ami|√≥w|i)?/gi;
                    } else if (baseWord === 'sur√≥wka') {
                        pattern = /sur√≥wk[ƒÖƒôi]/gi;
                    } else if (baseWord === 'jajka') {
                        pattern = /jajk(a|ami|o)?/gi;
                    } else if (baseWord === 'kotlet') {
                        pattern = /kotlet/gi;
                    } else {
                        pattern = new RegExp(`\\b${baseWord}`, 'gi');
                    }
                } else {
                    // Wielos≈Çowowe nazwy
                    pattern = new RegExp(food.replace(/\s+/g, '\\s+'), 'gi');
                }
                
                const matches = lowerText.match(pattern);
                
                if (matches) {
                    foundProducts.add(food);
                    let quantity = 1;
                    let unit = 'porcja';
                    
                    // Szukaj ilo≈õci przed nazwƒÖ produktu
                    const quantityWords = ['jeden', 'jedna', 'jedno', 'dwa', 'dwie', 'trzy', 'cztery', 'piƒôƒá'];
                    const wordToNumber = {
                        'jeden': 1, 'jedna': 1, 'jedno': 1,
                        'dwa': 2, 'dwie': 2, 'trzy': 3, 'cztery': 4, 'piƒôƒá': 5
                    };
                    
                    // Sprawd≈∫ czy jest liczba lub s≈Çowo przed produktem
                    for (const word of quantityWords) {
                        const qPattern = new RegExp(`\\b${word}\\s+${food}`, 'gi');
                        if (lowerText.match(qPattern)) {
                            quantity = wordToNumber[word];
                            break;
                        }
                    }
                    
                    // Sprawd≈∫ cyfry
                    const numPattern = new RegExp(`\\b(\\d+)\\s+${food}`, 'gi');
                    const numMatch = lowerText.match(numPattern);
                    if (numMatch) {
                        const num = parseInt(numMatch[0].match(/\d+/)[0]);
                        quantity = num;
                    }
                    
                    // Oblicz kalorie na podstawie produktu i ilo≈õci
                    let calories;
                    let displayUnit = unit;
                    
                    if (food === 'jajka' || food === 'jajko') {
                        calories = Math.round(155 * 0.6 * quantity); // 60g na jajko
                        displayUnit = quantity === 1 ? '1 jajko' : `${quantity} jajka`;
                    } else if (food === 'jajko sadzone') {
                        calories = Math.round(196 * 0.6 * quantity);
                        displayUnit = quantity === 1 ? '1 jajko sadzone' : `${quantity} jajka sadzone`;
                    } else if (food === 'bu≈Çka' || food === 'kajzerka') {
                        calories = Math.round(250 * 0.8 * quantity); // 80g na bu≈Çkƒô
                        displayUnit = quantity === 1 ? '1 bu≈Çka' : `${quantity} bu≈Çki`;
                    } else if (food === 'ser') {
                        calories = Math.round(350 * 0.3 * quantity); // 30g sera na porcjƒô
                        displayUnit = 'porcja na kanapkƒô';
                    } else if (food === 'szynka') {
                        calories = Math.round(145 * 0.4 * quantity); // 40g szynki na porcjƒô
                        displayUnit = 'porcja na kanapkƒô';
                    } else if (food === 'ziemniak') {
                        calories = Math.round(77 * 2 * quantity); // 200g ziemniak√≥w
                        displayUnit = 'porcja';
                    } else if (food === 'sur√≥wka') {
                        calories = Math.round(45 * 1 * quantity); // 100g sur√≥wki
                        displayUnit = 'porcja';
                    } else if (food === 'kotlet schabowy' || food === 'kotlet' || food === 'schabowy') {
                        calories = Math.round(250 * 1.2 * quantity); // 120g kotleta
                        displayUnit = 'porcja';
                        // Je≈õli ju≈º mamy kotlet, nie dodawaj duplikat√≥w
                        const hasKotlet = items.some(item => item.name.includes('kotlet') || item.name.includes('schabowy'));
                        if (hasKotlet) continue;
                    } else {
                        calories = Math.round(foodDatabase[food] * quantity);
                    }
                    
                    items.push({ name: `${food} (${displayUnit})`, calories });
                }
            }
            
            return items;
        }

        function analyzeFood() {
            const input = document.getElementById('foodInput').value.trim();
            if (!input) {
                alert('Proszƒô wprowadziƒá opis posi≈Çk√≥w!');
                return;
            }

            const foodItems = extractFoodItems(input);
            const totalCalories = foodItems.reduce((sum, item) => sum + item.calories, 0);

            displayResults(foodItems, totalCalories);
            addToHistory(input, foodItems, totalCalories);
        }

        function displayResults(items, total) {
            const resultsDiv = document.getElementById('results');
            
            if (items.length === 0) {
                resultsDiv.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 40px;">
                        Nie rozpoznano ≈ºadnych produkt√≥w. Spr√≥buj u≈ºyƒá innych nazw lub sprawd≈∫ przyk≈Çad.
                    </div>
                `;
                return;
            }

            const productsHtml = items.map(item => `
                <div class="product-item">
                    <span class="product-name">${item.name}</span>
                    <span class="product-calories">${item.calories} kcal</span>
                </div>
            `).join('');

            resultsDiv.innerHTML = `
                <div class="total-calories">
                    <h3>≈ÅƒÖczna liczba kalorii</h3>
                    <div class="number">${total}</div>
                    <div>kcal</div>
                </div>
                <div class="products-list">
                    <h4 style="margin-bottom: 15px; color: #333;">Rozpoznane produkty:</h4>
                    ${productsHtml}
                </div>
            `;
        }

        // Historia przechowywana w localStorage dla trwa≈Çego przechowywania
        function getHistory() {
            try {
                const history = localStorage.getItem('calorieHistory');
                return history ? JSON.parse(history) : [];
            } catch (e) {
                console.error('B≈ÇƒÖd odczytu historii:', e);
                return [];
            }
        }

        function saveHistory(history) {
            try {
                localStorage.setItem('calorieHistory', JSON.stringify(history));
            } catch (e) {
                console.error('B≈ÇƒÖd zapisu historii:', e);
            }
        }

        function addToHistory(input, items, total) {
            const entry = {
                id: Date.now(), // Unikalny identyfikator
                date: new Date().toLocaleString('pl-PL'),
                text: input,
                items: items,
                total: total
            };
            
            const history = getHistory();
            history.unshift(entry);
            
            // Zachowaj tylko 20 ostatnich wpis√≥w
            if (history.length > 20) {
                history.splice(20);
            }
            
            saveHistory(history);
            displayHistory();
        }

        function displayHistory() {
            const historyDiv = document.getElementById('history');
            const history = getHistory();
            
            if (history.length === 0) {
                historyDiv.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 20px;">
                        Brak historii wpis√≥w
                    </div>
                `;
                return;
            }

            const historyHtml = history.map(entry => `
                <div class="history-item">
                    <div class="history-date">${entry.date}</div>
                    <div class="history-text">"${entry.text}"</div>
                    <div class="history-calories">≈ÅƒÖcznie: ${entry.total} kcal (${entry.items.length} produkt√≥w)</div>
                </div>
            `).join('');

            historyDiv.innerHTML = historyHtml;
        }

        function clearHistory() {
            if (confirm('Czy na pewno chcesz wyczy≈õciƒá historiƒô?')) {
                localStorage.removeItem('calorieHistory');
                displayHistory();
            }
        }

        // Funkcje trybu ciemnego
        function getTheme() {
            return localStorage.getItem('theme') || 'light';
        }

        function setTheme(theme) {
            localStorage.setItem('theme', theme);
            document.body.className = theme === 'dark' ? 'dark-mode' : '';
            
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            
            if (theme === 'dark') {
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = 'Tryb jasny';
            } else {
                themeIcon.textContent = 'üåô';
                themeText.textContent = 'Tryb ciemny';
            }
        }

        function toggleTheme() {
            const currentTheme = getTheme();
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }

        // Inicjalizacja aplikacji
        window.onload = function() {
            displayHistory();
            setTheme(getTheme()); // Zastosuj zapisany motyw
        };

        // Obs≈Çuga Enter w textarea
        document.getElementById('foodInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                analyzeFood();
            }
        });
    </script>
</body>
</html>
